{% extends 'base.html' %}
{% block title %}Home | Y{% endblock title %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <h2 class="text-2xl font-semibold text-sky-700 mb-6 text-center">Recent Posts</h2>

  {% if posts %}
    <div class="space-y-6">
      {% for post in posts %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition p-5">
          <div class="flex items-start justify-between relative mb-2">
            <div>
              <h3 class="font-semibold text-gray-800">{{ post.user.username }}</h3>
              <p class="text-sm text-gray-500">{{ post.created_at|date:"M d, Y H:i" }}</p>
            </div>

            <div class="relative inline-block text-left">
              <button id="menu-button-{{ post.id }}" onclick="toggleDropdown({{ post.id }})"
                class="p-2 rounded-full hover:bg-gray-100 focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M6 12h.01M12 12h.01M18 12h.01" />
                </svg>
              </button>

              <div id="dropdown-menu-{{ post.id }}"
                class="hidden absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg py-2 z-20">
                <a href="{% url 'post_create' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Edit</a>
                <a href="{% url 'post_delete' %}" class="block px-4 py-2 text-sm text-red-700 hover:bg-gray-100">Delete</a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Share</a>
              </div>
            </div>
          </div>

          <p class="text-gray-700 whitespace-pre-line mb-3">{{ post.text }}</p>

          {% if post.images %}
            <div class="rounded-lg overflow-hidden border border-gray-100">
              <img src="{{ post.images.url }}" alt="Post Image" class="w-full object-cover">
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-center text-gray-500">
      No posts yet. <a href="{% url 'post_create' %}" class="text-sky-600 hover:underline">Create one?</a>
    </p>
  {% endif %}

  <div class="mt-10 flex justify-center">
    <a href="{% url 'post_create' %}" class="bg-sky-600 text-white px-5 py-2 rounded-lg hover:bg-sky-700 transition">
      + New Post
    </a>
  </div>
</div>
{% endblock content %}

{% block extra_scripts %}
<script>
function toggleDropdown(postId) {
  const menu = document.getElementById(`dropdown-menu-${postId}`);
  menu.classList.toggle('hidden');
}

document.addEventListener('click', function(event) {
  document.querySelectorAll('[id^="dropdown-menu-"]').forEach(menu => {
    const buttonId = menu.id.replace('dropdown-menu-', 'menu-button-');
    const button = document.getElementById(buttonId);
    if (!button.contains(event.target) && !menu.contains(event.target)) {
      menu.classList.add('hidden');
    }
  });
});
</script>
{% endblock extra_scripts %}
